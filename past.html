<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MO7S — past</title>
<link rel="icon" href="favicon.ico" sizes="any" />
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16.png" />
  <link rel="apple-touch-icon" href="assets/favicon/apple-touch-icon.png" />
  <link rel="manifest" href="site.webmanifest" />
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png" />
  <link rel="manifest" href="site.webmanifest" />
<meta name="description" content="MO7S — past" />
  <style>
    @font-face {
      font-family: 'Roadway';
      src: url('assets/Roadway.ttf') format('truetype');
      font-display: swap;
    }

    :root {
      --bg: #080808;
      --ink: #f2f2f2;
      --muted: #a8a8a8;
      --tile: #101010;
      --shadow: rgba(0,0,0,0.55);
      --gap: 14px;
      --radius: 14px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      color: var(--ink);
      background: radial-gradient(1200px 800px at 50% 25%, #141414, var(--bg));
      min-height: 100vh;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 5;
      backdrop-filter: blur(10px);
      background: rgba(0,0,0,0.45);
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .bar {
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 10px;
      width: auto;
    }

    .brand a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
    }

    .logo {
      width: 54px;
      height: 54px;
      object-fit: contain;
      display: block;
      opacity: 0.98;
      filter: none;
    }

    .brand span {
      color: rgba(242,242,242,0.72);
      font-family: 'Roadway', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      font-weight: 400;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      font-size: 1.0rem;
      display: inline-block;
    }

    .subnav {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-left: 10px;
      padding-left: 14px;
      border-left: 1px solid rgba(255,255,255,0.10);
      flex-wrap: wrap;
    }

    .subnav a {
      text-decoration: none;
      color: rgba(242,242,242,0.65);
      font-size: 0.72rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(16,16,16,0.35);
    }

    .subnav a[aria-current="page"] {
      color: rgba(242,242,242,0.92);
      border-color: rgba(255,255,255,0.22);
      background: rgba(16,16,16,0.55);
    }

    .section {
      margin-top: 18px;
    }

    .section__title {
      margin: 0 0 12px;
      font-family: 'Roadway', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      font-size: 0.9rem;
      color: rgba(242,242,242,0.65);
    }

    .embed {
      margin: 10px 0 14px;
    }

    /* Apple Music cover stack (cover is the link) */
     .am-stack {
      position: relative;
      display: inline-block;
      width: 100%;
      max-width: 320px;
      border-radius: 16px;
      overflow: hidden;
    }

    .am-cover {
      width: 100%;
      aspect-ratio: 1 / 1;
      display: block;
      object-fit: cover;
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 14px 44px rgba(0,0,0,0.55);
    }

    .flip {
      transform: none;
    }

    .hint {
      color: var(--muted);
      font-size: 0.9rem;
      white-space: nowrap;
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 16px 42px;
    }

    /* “flyer wall” grid */
    .wall {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: var(--gap);
      align-items: start;
    }

    .flyer {
      position: relative;
      display: block;
      border-radius: var(--radius);
      overflow: hidden;
      background: var(--tile);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 10px 28px var(--shadow);
      transform: rotate(var(--r, 0deg));
      transition: transform 180ms ease, box-shadow 180ms ease, border-color 180ms ease;
      cursor: zoom-in;
    }

    .flyer:hover {
      transform: rotate(var(--r, 0deg)) translateY(-2px);
      border-color: rgba(255,255,255,0.18);
      box-shadow: 0 14px 34px rgba(0,0,0,0.7);
    }

    .flyer img {
      width: 100%;
      height: auto;
      display: block;
      aspect-ratio: 3 / 4;
      object-fit: cover;
      filter: contrast(1.05) saturate(1.02);
    }

    /* subtle “grunge” overlay without heavy filters */
    .playbadge {
      position: absolute;
      inset: 10px 10px auto auto;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.16);
      display: grid;
      place-items: center;
      color: rgba(242,242,242,0.9);
      font-size: 14px;
      line-height: 1;
      pointer-events: none;
      z-index: 2;
    }

    .flyer[data-video="1"]::before {
      content: "";
      position: absolute;
      inset: 0;
      z-index: 1;
    }

    .flyer::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.06), rgba(0,0,0,0.12)),
        radial-gradient(400px 240px at 20% 20%, rgba(255,255,255,0.08), transparent 60%),
        radial-gradient(420px 280px at 80% 70%, rgba(0,0,0,0.22), transparent 65%);
      mix-blend-mode: overlay;
      opacity: 0.9;
    }

    /* viewer */
    .viewer {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 20;
      background: rgba(0,0,0,0.8);
    }

    .viewer[aria-hidden="false"] { display: flex; }

    .tapplay {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 6;
      background: rgba(0,0,0,0.25);
    }

    .tapplay[aria-hidden="false"] {
      display: flex;
    }

    .tapplay__btn {
      appearance: none;
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(16,16,16,0.65);
      color: rgba(242,242,242,0.92);
      border-radius: 999px;
      padding: 12px 16px;
      font-size: 1rem;
      letter-spacing: 0.06em;
      cursor: pointer;
    }

    .viewer__frame {
      width: min(92vw, 960px);
      max-height: 88vh;
      border-radius: 16px;
      overflow: hidden;
      background: #000;
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 18px 60px rgba(0,0,0,0.75);
      position: relative;
    }

        .viewer__vid {
      width: 100%;
      height: auto;
      max-height: 88vh;
      display: none;
      background: #000;
    }

    .viewer__vid[aria-hidden="false"] {
      display: block;
    }

    .viewer__img {
      width: 100%;
      height: auto;
      max-height: 88vh;
      display: block;
      object-fit: contain;
      background: #000;
    }

    .nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(16,16,16,0.55);
      color: var(--ink);
      display: grid;
      place-items: center;
      font-size: 28px;
      line-height: 1;
      cursor: pointer;
      user-select: none;
    }

    .nav:hover { border-color: rgba(255,255,255,0.3); }
    .nav:active { transform: translateY(-50%) scale(0.98); }

    .nav--prev { left: 10px; }
    .nav--next { right: 10px; }

    @media (max-width: 640px) {
      .nav { width: 40px; height: 40px; font-size: 26px; }
    }

    .viewer__top {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.75), rgba(0,0,0,0));
      gap: 10px;
    }

    .btn {
      appearance: none;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(16,16,16,0.55);
      color: var(--ink);
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .btn:active { transform: translateY(1px); }

    .cap {
      color: var(--muted);
      font-size: 0.9rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 55ch;
    }

    @media (max-width: 640px) {
      .hint { display: none; }
      .wall { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); }
    }
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="brand">
        <a href="index.html" aria-label="MO7S home">
          <img class="logo" src="assets/mo7s-mark.png" alt="MO7S" decoding="async" />
        </a>
        <span>PAST</span>
      </div>

      <nav class="subnav" aria-label="Past sections">
        <a href="#appearances" id="lnk-appearances">appearances</a>
        <a href="#events" id="lnk-events">events</a>
        <a href="#releases" id="lnk-releases">releases</a>
      </nav>
    </div>
  </header>

  <main>
        <details class="sect" id="appearances">
      <summary>
        <span class="chev">›</span>
        <h2 class="section__title">appearances</h2>
      </summary>
      <div class="sect__body">
        <div class="wall" id="wall-appearances"></div>
      </div>
    </details>

    <details class="sect" id="events">
      <summary>
        <span class="chev">›</span>
        <h2 class="section__title">events</h2>
      </summary>
      <div class="sect__body">
        <div class="wall" id="wall-events"></div>
      </div>
    </details>

    <details class="sect" id="releases">
      <summary>
        <span class="chev">›</span>
        <h2 class="section__title">releases</h2>
      </summary>
      <div class="sect__body">
        <div class="embed">
          <a class="am-stack" href="https://music.apple.com/us/artist/mo7s/275693837" target="_blank" rel="noopener noreferrer" aria-label="MO7S on Apple Music">
            <img class="am-cover" src="https://is1-ssl.mzstatic.com/image/thumb/Music/v4/22/5f/83/225f83d8-94f0-c735-dc54-6f77c513f5c0/888608738279.jpg/600x600bb.jpg" alt="MO7S cover art" loading="lazy" decoding="async" />
          </a>
        </div>
        <div class="wall" id="wall-releases"></div>
      </div>
    </details>
  </main>

  <div class="viewer" id="viewer" aria-hidden="true">
    <div class="viewer__frame" role="dialog" aria-modal="true" aria-label="Flyer viewer">
      <div class="viewer__top">
        <button class="btn" id="closeBtn" type="button">close</button>
        <div class="cap" id="cap"></div>
        <button class="btn" id="muteBtn" type="button" style="display:none">mute</button>
        <a class="btn" id="openFull" href="#" target="_blank" rel="noopener noreferrer">open</a>
      </div>

      <button class="nav nav--prev" id="prevBtn" type="button" aria-label="Previous">‹</button>
      <button class="nav nav--next" id="nextBtn" type="button" aria-label="Next">›</button>

      <div class="tapplay" id="tapplay" aria-hidden="true"><button class="tapplay__btn" id="tapplayBtn" type="button">tap to play</button></div>
      <video class="viewer__vid" id="viewerVid" playsinline controls preload="metadata"></video>
      <img class="viewer__img" id="viewerImg" alt="" />
    </div>
  </div>

  <script>
    // Lightweight: load manifest, render thumbs, lazy-load by browser.
    // Tap opens viewer; full-size image loads on demand.
    const MANIFEST_URL = 'past-manifest.json';
    const ASSET_VER = 'rotfix1'; // cache-buster for rotated images

    const wallEvents = document.getElementById('wall-events');
    const wallReleases = document.getElementById('wall-releases');
    const wallAppearances = document.getElementById('wall-appearances');
    const viewer = document.getElementById('viewer');
    const viewerImg = document.getElementById('viewerImg');
    const viewerVid = document.getElementById('viewerVid');
    const tapplay = document.getElementById('tapplay');
    const tapplayBtn = document.getElementById('tapplayBtn');
    const cap = document.getElementById('cap');
    const openFull = document.getElementById('openFull');
    const muteBtn = document.getElementById('muteBtn');
    const closeBtn = document.getElementById('closeBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    let ITEMS = [];

    // Viewer navigation should stay within the section you opened from.
    // currentView = array of manifest indexes (in the *rendered* order for that section).
    let currentView = [];
    let viewPos = -1;

      muteBtn.style.display = 'none';
      tapplay.setAttribute('aria-hidden','true');

    function currentItem() {
      if (!currentView.length || viewPos < 0) return null;
      const idx = currentView[viewPos];
      return ITEMS[idx] || null;
    }

    function renderViewer() {
      const item = currentItem();
      if (!item) return;
      cap.textContent = item.title || '';
      const fullUrl = item.full + (item.full.includes('?') ? '&' : '?') + 'v=' + ASSET_VER;
      const videoUrl = item.video ? (item.video + (item.video.includes('?') ? '&' : '?') + 'v=' + ASSET_VER) : null;

      // stop previous video
      viewerVid.pause();
      viewerVid.removeAttribute('src');
      viewerVid.load();

      if (videoUrl) {
        muteBtn.style.display = 'inline-block';
        muteBtn.textContent = (viewerVid.muted ? 'unmute' : 'mute');
        viewerImg.setAttribute('aria-hidden','true');
        viewerImg.style.display = 'none';
        viewerVid.setAttribute('aria-hidden','false');
        viewerVid.style.display = 'block';
        viewerVid.src = videoUrl;
        // autoplay on first click (muted+playsinline enables mobile autoplay)
        viewerVid.muted = false;
        viewerVid.volume = 1.0;
        viewerVid.play().catch(() => { /* autoplay with audio may be blocked */ });
      } else {
        muteBtn.style.display = 'none';
      tapplay.setAttribute('aria-hidden','true');
        viewerVid.setAttribute('aria-hidden','true');
        viewerVid.style.display = 'none';
        viewerImg.setAttribute('aria-hidden','false');
        viewerImg.style.display = 'block';
        viewerImg.src = fullUrl;
        viewerImg.alt = item.title || 'flyer';
      }

      openFull.href = videoUrl || fullUrl;
    }

    function attemptPlayWithAudio() {
      viewerVid.muted = false;
      viewerVid.volume = 1.0;
      const p = viewerVid.play();
      if (p && typeof p.catch === 'function') {
        p.catch(() => {
          // browser blocked audible autoplay; show explicit tap-to-play
          tapplay.setAttribute('aria-hidden','false');
        });
      }
    }

    function openViewer(view, pos) {
      currentView = Array.isArray(view) ? view : [];
      viewPos = Math.max(0, Math.min(pos, currentView.length - 1));
      const item = currentItem();
      if (!item) return;

      viewer.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';

      // Render title + links
      cap.textContent = item?.title || '';
      const fullUrl = item.full + (item.full.includes('?') ? '&' : '?') + 'v=' + ASSET_VER;
      const videoUrl = item.video ? (item.video + (item.video.includes('?') ? '&' : '?') + 'v=' + ASSET_VER) : null;

      // stop previous video
      viewerVid.pause();
      viewerVid.removeAttribute('src');
      viewerVid.load();
      tapplay.setAttribute('aria-hidden','true');

      if (videoUrl) {
        viewerImg.setAttribute('aria-hidden','true');
        viewerImg.style.display = 'none';
        viewerVid.setAttribute('aria-hidden','false');
        viewerVid.style.display = 'block';
        viewerVid.src = videoUrl;
        openFull.href = videoUrl;
        muteBtn.style.display = 'inline-block';
        muteBtn.textContent = (viewerVid.muted ? 'unmute' : 'mute');

        // IMPORTANT: attempt play immediately (still inside the click handler)
        attemptPlayWithAudio();
      } else {
        muteBtn.style.display = 'none';
        viewerVid.setAttribute('aria-hidden','true');
        viewerVid.style.display = 'none';
        viewerImg.setAttribute('aria-hidden','false');
        viewerImg.style.display = 'block';
        viewerImg.src = fullUrl;
        viewerImg.alt = item.title || 'flyer';
        openFull.href = fullUrl;
      }
    }

    function closeViewer() {
      viewer.setAttribute('aria-hidden', 'true');
      viewerImg.src = '';
      viewerVid.pause();
      viewerVid.removeAttribute('src');
      viewerVid.load();
      document.body.style.overflow = '';
      currentView = [];
      viewPos = -1;
      muteBtn.style.display = 'none';
      tapplay.setAttribute('aria-hidden','true');
    }

    function next() {
      if (!currentView.length) return;
      viewPos = (viewPos + 1) % currentView.length;
      openViewer(currentView, viewPos);
    }

    function prev() {
      if (!currentView.length) return;
      viewPos = (viewPos - 1 + currentView.length) % currentView.length;
      openViewer(currentView, viewPos);
    }

    viewer.addEventListener('click', (e) => {
      // click backdrop closes
      if (e.target === viewer) closeViewer();
    });
    closeBtn.addEventListener('click', closeViewer);
    nextBtn.addEventListener('click', next);
    prevBtn.addEventListener('click', prev);
    tapplayBtn.addEventListener('click', () => {
      tapplay.setAttribute('aria-hidden','true');
      attemptPlayWithAudio();
    });

    muteBtn.addEventListener('click', () => {
      viewerVid.muted = !viewerVid.muted;
      muteBtn.textContent = viewerVid.muted ? 'unmute' : 'mute';
    });

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') return closeViewer();
      if (viewer.getAttribute('aria-hidden') === 'true') return;
      if (e.key === 'ArrowRight') return next();
      if (e.key === 'ArrowLeft') return prev();
    });

    // Simple mobile swipe (left/right) inside the viewer frame
    let touchX0 = null;
    let touchY0 = null;
    const SWIPE_MIN_X = 40;
    const SWIPE_MAX_Y = 60;

    function onTouchStart(e) {
      const t = e.changedTouches && e.changedTouches[0];
      if (!t) return;
      touchX0 = t.clientX;
      touchY0 = t.clientY;
    }

    function onTouchEnd(e) {
      if (touchX0 == null || touchY0 == null) return;
      const t = e.changedTouches && e.changedTouches[0];
      if (!t) return;
      const dx = t.clientX - touchX0;
      const dy = t.clientY - touchY0;

      touchX0 = null;
      touchY0 = null;

      if (viewer.getAttribute('aria-hidden') === 'true') return;
      if (Math.abs(dx) < SWIPE_MIN_X) return;
      if (Math.abs(dy) > SWIPE_MAX_Y) return;

      if (dx < 0) next();
      else prev();
    }

    const frame = document.querySelector('.viewer__frame');
    frame.addEventListener('touchstart', onTouchStart, { passive: true });
    frame.addEventListener('touchend', onTouchEnd, { passive: true });

    fetch(MANIFEST_URL)
      .then(r => r.json())
      .then(data => {
        ITEMS = data.items || [];

        // For sorting: support YYYY, YYYY-MM, YYYY-MM-DD. Unknown dates sort last.
        function dateKey(v) {
          if (!v) return -Infinity;
          const s = String(v).trim();
          const m = s.match(/^(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?$/);
          if (!m) return -Infinity;
          const y = Number(m[1]);
          const mo = Number(m[2] || '01');
          const d = Number(m[3] || '01');
          // use UTC millis as comparable key
          const t = Date.UTC(y, Math.max(0, mo - 1), Math.max(1, d));
          return Number.isFinite(t) ? t : -Infinity;
        }

        const buckets = { appearances: [], events: [], releases: [] };
        ITEMS.forEach((item, i) => {
          const cat = (item.category || 'events').toLowerCase();
          (buckets[cat] || buckets.events).push({ item, i });
        });

        // Events: pinned first (item.pin), then newest → oldest by item.date (event date).
        // No-date items sort last unless pinned.
        buckets.events.sort((a, b) => {
          const pa = Number(a.item.pin || 0);
          const pb = Number(b.item.pin || 0);
          if (pa !== pb) return pb - pa;

          const ka = dateKey(a.item.date);
          const kb = dateKey(b.item.date);
          if (ka !== kb) return kb - ka;

          // stable-ish fallback
          const ta = (a.item.title || '').toLowerCase();
          const tb = (b.item.title || '').toLowerCase();
          if (ta < tb) return -1;
          if (ta > tb) return 1;
          return a.i - b.i;
        });

        const frags = { appearances: document.createDocumentFragment(), events: document.createDocumentFragment(), releases: document.createDocumentFragment() };

        function makeTile(item, i, view, pos) {
          const a = document.createElement('a');
          a.className = 'flyer';
          // slight randomness for wall feel (use manifest index so it stays consistent)
          const r = ((i % 7) - 3) * 0.35; // -1.05..+1.05 deg
          a.style.setProperty('--r', r.toFixed(2) + 'deg');
          a.href = item.full;
          a.addEventListener('click', (e) => {
            e.preventDefault();
            openViewer(view, pos);
          });

          const img = document.createElement('img');
          img.loading = 'lazy';
          img.decoding = 'async';
          img.src = item.thumb + (item.thumb.includes('?') ? '&' : '?') + 'v=' + ASSET_VER;
          img.alt = item.title || 'flyer';
          a.appendChild(img);
          return a;
        }

        const eventsView = buckets.events.map(x => x.i);
        const releasesView = buckets.releases.map(x => x.i);
        const appearancesView = buckets.appearances.map(x => x.i);

        buckets.events.forEach(({ item, i }, pos) => frags.events.appendChild(makeTile(item, i, eventsView, pos)));
        buckets.releases.forEach(({ item, i }, pos) => frags.releases.appendChild(makeTile(item, i, releasesView, pos)));
        buckets.appearances.forEach(({ item, i }, pos) => frags.appearances.appendChild(makeTile(item, i, appearancesView, pos)));

        wallEvents.appendChild(frags.events);
        wallReleases.appendChild(frags.releases);
        wallAppearances.appendChild(frags.appearances);

        // set active pill based on hash
        function setActive() {
          const h = (location.hash || '').replace('#','');
          for (const k of ['appearances','events','releases']) {
            const a = document.getElementById('lnk-'+k);
            if (a) a.setAttribute('aria-current', k===h ? 'page' : 'false');
          }
        }
        setActive();
        window.addEventListener('hashchange', setActive);

        function openSection() {
          const h = (location.hash || '').replace('#','');
          for (const k of ['appearances','events','releases']) {
            const d = document.getElementById(k);
            if (d && d.tagName === 'DETAILS') {
              d.open = (h ? (k === h) : false);
            }
          }
        }
        openSection();
        window.addEventListener('hashchange', openSection);
      })
      .catch(() => {
        wallEvents.textContent = 'Could not load flyers.';
      });
  </script>
</body>
</html>
